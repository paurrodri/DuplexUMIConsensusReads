# Clear workspace ---------------------------------------------------------
rm (list = ls())
# Load libraries ----------------------------------------------------------
library(tools)
library(tidyverse)
# Load functions ----------------------------------------------------------
cm.read.rds <- function(file) {
out <- readRDS(file)
message(paste(attr(out, "cm.signature"), collapse = "  "))
out
}
cm.save.rds <- function(x, file = paste0(deparse(substitute(x)), ".rds")) {
library(digest)
message("Saving as ", file)
attr(x, "cm.signature") <- NULL
cm.signature <- c(MD5.hash = digest(x),
creation.time = format(Sys.time()),
creation.dir  = getwd(),
created.by    = unname(Sys.info()['user']))
attr(x, "cm.signature") <- cm.signature
message(paste(cm.signature, collapse = "  "))
saveRDS(x, file = file)
}
# Define directories ------------------------------------------------------
study_name   <- "snimli"
study_dir      <- paste0("X:/Dropbox (CM)/Main/studies/", study_name)
data_dir       <- paste0(study_dir, "/analysis_with comensals/computerome_04-02-20/")
protein_dir    <- paste0(study_dir, "/surface_proteins/phenotype_extraction_pipeline/")
phenotypes_dir <- paste0(protein_dir, "/PHENOTYPES/")
# Phage outcome - 425 rows (species) x 4 phages
phenotypes     <- cm.read.rds(paste0(data_dir, "phenotypes_commensals_2.rds"))
# Metadata - 425 rows (species) x 182 metadata cols
meta <- cm.read.rds(paste0(data_dir, "metadataOneHot_commensals.rds"))
protein_files <- list.files(path = phenotypes_dir, pattern = "*.RData")
protein_column <- cm.read.rds(paste0(phenotypes_dir, protein_files[1]))
proteins       <- tibble(species = rownames(protein_column),
protein_column)
for (file in protein_files [2:length(protein_files)] ) {
protein_column <- cm.read.rds(paste0(phenotypes_dir, file))
protein_column <- tibble(species = rownames(protein_column),
protein_column)
proteins <- proteins %>% full_join(protein_column,
by = "species")
}
# Edit protein data set ---------------------------------------------------
# Change species name (remove suffixes e.g. upec....)
proteins <- proteins %>%
mutate (species = sapply(strsplit(species, "_"), `[`, 1))
# Join to metadata --------------------------------------------------------
# in progress
meta_tibble <- tibble(meta, rownames = NA)
View(meta_tibble)
# Join to metadata --------------------------------------------------------
# in progress
meta_tibble <- tibble(meta)
View(meta_tibble)
# Metadata - 425 rows (species) x 182 metadata cols
meta <- cm.read.rds(paste0(data_dir, "metadataOneHot_commensals.rds"))
View(meta)
typeof(meta)
# Join to metadata --------------------------------------------------------
# in progress
meta_tibble <- as_tibble(meta)
View(meta_tibble)
rownames(meta)
meta_tibble %<>%
add_column(species = rownames(meta))
meta_tibble <- meta_tibble %>%
add_column(species = rownames(meta))
View(meta_tibble)
# Join to metadata --------------------------------------------------------
# in progress
meta_tibble <- as_tibble(meta)
# Join to metadata --------------------------------------------------------
# in progress
#meta_tibble <-
meta_tibble <- as_tibble(meta) %>%
add_column(species = rownames(meta)) %>%
select (species, everything())
View(meta_tibble)
View(meta)
?right_join
joined_meta_proteins <- proteins %>%
right_join(meta_tibble)
View(joined_meta_proteins)
joined_meta_proteins <- meta_tibble %>%
left_join(proteins)
View(joined_meta_proteins)
View(meta_tibble)
# Check number of species with protein phenotypes -------------------------
arbitrary_column <- colnames(proteins)[1]
# Check number of species with protein phenotypes -------------------------
arbitrary_column <- colnames(proteins)[2]
joined_meta_proteins %>%
select(arbitrary_column)
joined_meta_proteins %>%
select(arbitrary_column) %>%
sum(is.na)
joined_meta_proteins %>%
select(arbitrary_column) %>%
is.na
joined_meta_proteins %>%
select(arbitrary_column) %>%
exclude_na()
joined_meta_proteins %>%
select(arbitrary_column) %>%
na.exclude()
joined_meta_proteins %>%
select(arbitrary_column) %>%
na.exclude() %>%
length()
joined_meta_proteins %>%
select(arbitrary_column) %>%
na.exclude() %>%
count()
# Clear workspace ---------------------------------------------------------
rm (list = ls())
# Load libraries ----------------------------------------------------------
library(tools)
library(tidyverse)
# Load functions ----------------------------------------------------------
cm.read.rds <- function(file) {
out <- readRDS(file)
message(paste(attr(out, "cm.signature"), collapse = "  "))
out
}
cm.save.rds <- function(x, file = paste0(deparse(substitute(x)), ".rds")) {
library(digest)
message("Saving as ", file)
attr(x, "cm.signature") <- NULL
cm.signature <- c(MD5.hash = digest(x),
creation.time = format(Sys.time()),
creation.dir  = getwd(),
created.by    = unname(Sys.info()['user']))
attr(x, "cm.signature") <- cm.signature
message(paste(cm.signature, collapse = "  "))
saveRDS(x, file = file)
}
# Define directories ------------------------------------------------------
study_name   <- "snimli"
study_dir      <- paste0("X:/Dropbox (CM)/Main/studies/", study_name)
data_dir       <- paste0(study_dir, "/analysis_with comensals/computerome_04-02-20/")
protein_dir    <- paste0(study_dir, "/surface_proteins/phenotype_extraction_pipeline/")
phenotypes_dir <- paste0(protein_dir, "/PHENOTYPES/")
# Phage outcome - 425 rows (species) x 4 phages
phenotypes     <- cm.read.rds(paste0(data_dir, "phenotypes_commensals_2.rds"))
# Metadata - 425 rows (species) x 182 metadata cols
meta <- cm.read.rds(paste0(data_dir, "metadataOneHot_commensals.rds"))
protein_files <- list.files(path = phenotypes_dir, pattern = "*.RData")
protein_column <- cm.read.rds(paste0(phenotypes_dir, protein_files[1]))
proteins       <- tibble(species = rownames(protein_column),
protein_column)
for (file in protein_files [2:length(protein_files)] ) {
protein_column <- cm.read.rds(paste0(phenotypes_dir, file))
protein_column <- tibble(species = rownames(protein_column),
protein_column)
proteins <- proteins %>% full_join(protein_column,
by = "species")
}
# Edit protein data set ---------------------------------------------------
# Change species name (remove suffixes e.g. upec....)
proteins <- proteins %>%
mutate (species = sapply(strsplit(species, "_"), `[`, 1))
## RData
proteins %>%
select(species, contains("total")) %>%
cm.save.rds(., file = paste0(protein_dir, "surface_proteins_phenotypes_total.RData"))
proteins %>%
select(species, contains("average")) %>%
cm.save.rds(., file = paste0(protein_dir, "surface_proteins_phenotypes_average.RData"))
## .csv
proteins %>%
select(species, contains("total")) %>%
write_csv(.,
path = paste0(protein_dir, "surface_proteins_phenotypes_total.csv"),
col_names = TRUE)
proteins %>%
select(species, contains("average")) %>%
write_csv(.,
path = paste0(protein_dir, "surface_proteins_phenotypes_average.csv"),
col_names = TRUE,
)
study_name   <- "snimli"
study_dir      <- paste0("X:/Dropbox (CM)/Main/studies/", study_name)
data_dir       <- paste0(study_dir, "/analysis_with comensals/computerome_04-02-20/")
protein_dir    <- paste0(study_dir, "/surface_proteins/phenotype_extraction_pipeline/")
phenotypes_dir <- paste0(protein_dir, "/PHENOTYPES/")
rm(list=ls())
study_name   <- "snimli"
study_dir      <- paste0("X:/Dropbox (CM)/Main/studies/", study_name)
data_dir       <- paste0(study_dir, "/analysis_with comensals/computerome_04-02-20/")
protein_dir    <- paste0(study_dir, "/surface_proteins/phenotype_extraction_pipeline/")
phenotypes_dir <- paste0(protein_dir, "/PHENOTYPES/")
readRDS(paste0(protein_dir),"surface_proteins_phenotypes_average.RData")
readRDS(paste0(protein_dir,"surface_proteins_phenotypes_average.RData"))
prot <- readRDS(paste0(protein_dir,"surface_proteins_phenotypes_average.RData"))
View(prot)
rm(list=ls8)
rm(list=ls())
